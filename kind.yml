---
version: '3'
tasks:
  up:
    vars:
      n: '{{ .n | default "kind" }}'
      f: '{{ .f | default "" }}'
      set: '{{ .set | default "" }}'
      templateOnly: '{{ .templateOnly | default false }}'
    cmds:
      - |
        helm template chart-kind \
          {{ if .f }}-f {{ .f | quote }} \
          {{ end -}}
          {{ if .set }}--set {{ .set | quote }} \
          {{ end -}}
          {{ if .templateOnly -}}
          | kind create cluster \
             -n {{ .n | quote }} \
             --config=-
          {{- end }}
    status:
      - kind get kubeconfig -n {{ .n | quote }}
  delete:
    vars:
      n: '{{ .n | default "kind" }}'
    cmds:
      - kind delete clusters {{ .n | quote }}
