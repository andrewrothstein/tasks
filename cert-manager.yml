---
version: '3'
includes:
  jetstack: jetstack.yml
  kubectl:
    taskfile: kubectl.yml
    internal: true
    vars:
      n: cert-manager
  cm:
    taskfile: helm.yml
    internal: true
    vars:
      NAMESPACE: cert-manager
      NAME: cert-manager
      CHART_REPO_NAME: jetstack
      CHART_VER: 1.12.0
      CHART: cert-manager
      HELM_ARGS: --set installCRDs=true
  approver_policy:
    taskfile: helm.yml
    internal: true
    vars:
      NAMESPACE: cert-manager
      NAME: cert-manager-approver-policy
      CHART_REPO_NAME: jetstack
      CHART_VER: 0.6.3
      CHART: cert-manager-approver-policy
  csi_driver:
    taskfile: helm.yml
    internal: true
    vars:
      NAMESPACE: cert-manager
      NAME: cert-manager-csi-driver
      CHART_REPO_NAME: jetstack
      CHART_VER: 0.5.0
      CHART: cert-manager-csi-driver
  trust_manager:
    taskfile: helm.yml
    internal: true
    vars:
      NAMESPACE: cert-manager
      NAME: trust-manager
      CHART_REPO_NAME: jetstack
      CHART_VER: 0.5.0
      CHART: trust-manager
  ss:
    taskfile: kubectl.yml
    internal: true
    vars:
      n: cert-manager
      f: cert-manager-selfsigned-cluster-issuer.yml
tasks:
  default:
    deps:
      - install
  install:
    deps:
       - task: jetstack
    cmds:
      - task: kubectl:ns-create
      - task: cm:install
      - task: approver_policy:install
      - task: csi_driver:install
      - task: ss:apply
  delete:
    cmds:
      - task: ss:delete
      - task: csi_driver:delete
      - task: approver_policy:delete
      - task: cm:delete
      - task: kubectl:ns-delete
