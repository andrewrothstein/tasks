---
version: '3'
includes:
  jetstack: jetstack.yml
  kubectl:
    taskfile: kubectl.yml
    internal: true
    vars:
      n: cert-manager
  cm:
    taskfile: helm.yml
    internal: true
    vars:
      namespace: cert-manager
      name: cert-manager
      chart_repo_name: jetstack
      chart_ver: 1.12.4
      chart: cert-manager
      helm_args: --set installCRDs=true
  approver_policy:
    taskfile: helm.yml
    internal: true
    vars:
      namespace: cert-manager
      name: cert-manager-approver-policy
      chart_repo_name: jetstack
      chart_ver: 0.7.0
      chart: cert-manager-approver-policy
  csi_driver:
    taskfile: helm.yml
    internal: true
    vars:
      namespace: cert-manager
      name: cert-manager-csi-driver
      chart_repo_name: jetstack
      chart_ver: 0.5.0
      chart: cert-manager-csi-driver
  trust_manager:
    taskfile: helm.yml
    internal: true
    vars:
      namespace: cert-manager
      name: trust-manager
      chart_repo_name: jetstack
      chart_ver: 0.5.0
      chart: trust-manager
  ss:
    taskfile: kubectl.yml
    internal: true
    vars:
      n: cert-manager
      f: cert-manager-selfsigned-cluster-issuer.yml
tasks:
  default:
    deps:
      - install
  install:
    deps:
       - task: jetstack
    cmds:
      - task: kubectl:ns-create
      - task: cm:install
      - task: approver_policy:install
      - task: csi_driver:install
      - task: ss:apply
  delete:
    cmds:
      - task: ss:delete
      - task: csi_driver:delete
      - task: approver_policy:delete
      - task: cm:delete
      - task: kubectl:ns-delete
