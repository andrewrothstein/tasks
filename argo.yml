---
version: '3'
includes:
  argo-release:
    taskfile: argo-release.yml
    internal: true
    vars:
      n: argo
      v: 3.4.8
      p: workflows
tasks:
  default:
    deps:
      - apply
  apply:
    cmds:
      - task: argo-release:apply
  delete:
    cmds:
      - task: argo-release:delete
  list:
    vars:
      n: '{{ .n | default "argo" }}'
    cmds:
      - argo list -n {{ .n | quote }}
  test:
    vars:
      n: '{{ .n | default "argo" }}'
      f: '{{ .f | default "argo-hello-world.yml" }}'
      watch: '{{ .watch | default true }}'
    cmds:
      - >-
        argo submit
        -n {{ .n | quote }}
        {{- if .watch }} --watch{{ end }}
        {{ .f | quote }}
  port-forward:
    cmds:
      - kubectl -n argo port-forward deployment/argo-server 2746:2746
