---
version: '3'
tasks:
  apply:
    vars:
      NAME: '{{ .NAME }}'
      RESTART: '{{ .RESTART | default "always" }}'
      ARGS: '{{ .ARGS }}'
      IMAGE: '{{ .IMAGE }}'
    cmds:
      - |
        docker \
          run -d \
          --name={{ .NAME | quote }} \
          --restart={{ .RESTART | quote }}
          {{- if .ARGS }} \
          {{ .ARGS }}{{ end }} \
          {{ .IMAGE | quote }}
    status:
      - |
        docker ps \
          --filter "name={{ .NAME }}" \
          --format '{"Names":{{ "{{ .Names }}" | quote }} }' \
          | jq -e -s '.[] | select(.Names=={{ .NAME | quote}})'
  delete:
    vars:
      NAME: '{{ .NAME }}'
    cmds:
      - docker rm -f {{ .NAME | quote }}
