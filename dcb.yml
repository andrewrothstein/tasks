---
version: '3'
includes:
  pip:
    internal: true
    taskfile: python-pip.yml
tasks:
  install:
    cmds:
      - task: pip:install
        vars:
          pkg: 'dcb=={{ .dcbver | default "0.1.2" }}'
  default:
    vars:
      dcb: '{{ .dcb | default "dcb" }}'
      upstreamregistry: '{{ .upstreamregistry | default "ghcr.io" }}'
      upstreamgroup: '{{ .upstreamgroup | default "andrewrothstein" }}'
      upstreamapp: '{{ .upstreamapp | default "docker-ansible" }}'
      targetregistry: '{{ .targetregistry | default "andrewrothstein" }}'
      snippets: '{{ .snippets | default "from.j2 ansible-test-role.j2" }}'
      pullall: '{{ .pullall | default true }}'
      writeall: '{{ .writeall | default true }}'
      buildall: '{{ .buildall | default true }}'
      pushall: '{{ .pushall | default false }}'
      alltags: '{{ .alltags | default "" }}'
    cmds:
      - |
        cd {{ .USER_WORKING_DIR }};
        {{ .dcb | quote }} \
          --upstreamregistry {{ .upstreamregistry | quote }} \
          --upstreamgroup {{ .upstreamgroup | quote }} \
          --upstreamapp {{ .upstreamapp | quote }} \
          --targetregistry {{ .targetregistry | quote }} \
          --snippet {{ .snippets }} \
          {{ if .pullall }}--pullall{{ end }} \
          {{ if .writeall }}--writeall{{ end }} \
          {{ if .buildall }}--buildall{{ end }} \
          {{ if .pushall }}--pushall{{ end }} \
          {{ if .alltags }}--alltags {{ .alltags | quote }}{{ end }}
