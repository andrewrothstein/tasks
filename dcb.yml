---
version: '3'
includes:
  pip:
    internal: true
    taskfile: python-pip.yml
tasks:
  install:
    cmds:
      - task: pip:install
        vars:
          pkg: 'dcb=={{ .dcbver | default "0.1.2" }}'
  default:
    vars:
      dcb: '{{ .dcb | default "dcb" }}'
      upstreamregistry: '{{ .upstreamregistry | default "ghcr.io" }}'
      upstreamgroup: '{{ .upstreamgroup | default "andrewrothstein" }}'
      upstreamapp: '{{ .upstreamapp | default "docker-ansible" }}'
      targetregistry: '{{ .targetregistry | default .upstreamregsitry }}'
      alltags: '{{ .alltags | default "" }}'
    deps:
      - install
    cmds:
      - |
        cd {{ .USER_WORKING_DIR }};
        {{ .dcb | quote }} \
          --upstreamregistry {{ .upstreamregistry | quote }} \
          --upstreamgroup {{ .upstreamgroup | quote }} \
          --upstreamapp {{ .upstreamapp | quote }} \
          --targetregistry {{ .targetregistry | quote }} \
          --snippet from.j2 ansible-test-role.j2 \
          --pullall \
          --writeall \
          --buildall \
          {{ if .alltags }}--alltags {{ .alltags | quote }}{{ end }}
